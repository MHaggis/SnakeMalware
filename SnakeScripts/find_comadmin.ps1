function CalculateEntropy($bytes) {
    $byteCounts = @{}

    foreach ($byte in $bytes) {
        if ($byteCounts.ContainsKey($byte)) {
            $byteCounts[$byte]++
        } else {
            $byteCounts[$byte] = 1
        }
    }

    $entropy = 0
    $totalBytes = $bytes.Count

    foreach ($byteCount in $byteCounts.Values) {
        $probability = $byteCount / $totalBytes
        $entropy -= $probability * [Math]::Log($probability, 2)
    }

    return $entropy
}

$comPath = Join-Path $env:windir "system32\Com"
$filenamePattern = 'comadmin\.dat$'

Write-Host "Scanning for comadmin.dat files in $comPath..."

$comadminFiles = Get-ChildItem -File -Path $comPath | Where-Object {
    $_.Name -match $filenamePattern
}

if ($comadminFiles) {
    Write-Host "Found comadmin.dat files. Checking entropy..."

    foreach ($file in $comadminFiles) {
        $bytes = [System.IO.File]::ReadAllBytes($file.FullName)
        $entropy = CalculateEntropy($bytes)

        if ($entropy -ge 7.0) {
            Write-Host "High entropy comadmin.dat found at: $($file.FullName)"
        } else {
            Write-Host "comadmin.dat with low entropy found at: $($file.FullName)"
        }
    }
} else {
    Write-Host "No comadmin.dat files found in $comPath."
}